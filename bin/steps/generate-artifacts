#!/usr/bin/env bash

# This is used in a library imported by toolbox.sh
# shellcheck disable=SC2034
deps=(pandoc)

# This file will be checked separately
# shellcheck disable=SC1091
. bin/lib/toolbox.sh

pandoc() {
  command pandoc -o "${2%.*}.$1" -f markdown -t "$1" -s --toc \
    "${extra_args[@]}" "$2"
}

md2html() {
  local extra_args=()
  pandoc html "$@"
}

md2pdf() {
  pandoc pdf "$@"
}

for file do
  notice "processing file %s" "$file"

  if [[ ! -r $file ]]; then
    error "unable to load file %s" "$file"
    continue
  fi

  if ! md2html "$file"; then
    die "file %s could not be converted to html" "$file"
  fi

  notice "generated html build of file %s" "$file"
  
  if ! md2pdf "$file"; then
    die "file %s could not be converted to pdf" "$file"
  fi

  notice "generated pdf build of file %s" "$file"
done
